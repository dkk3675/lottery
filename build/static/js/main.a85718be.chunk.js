(this["webpackJsonplottery-react"]=this["webpackJsonplottery-react"]||[]).push([[0],{26:function(e,t,n){},27:function(e,t,n){},34:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),s=n(13),c=n.n(s),o=(n(26),n(4)),i=n(10),u=n(5),l=n(6),h=n(19),p=n(18),b=(n(27),n(17)),d=new(n.n(b).a)(window.ethereum),m=new d.eth.Contract([{constant:!0,inputs:[],name:"manager",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"pickWinner",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[],name:"getPlayers",outputs:[{name:"",type:"address[]"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"winner",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"enter",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[{name:"",type:"uint256"}],name:"players",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"}],"0x2c06AFe194FA2942DDcF9DabCaB9B79E2DF396F3"),f=n(36),j=n.p+"static/media/lottery.1bae6b1d.png",y=n(8),w=(n(28),n(3)),g=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).handleAccountsChanged=function(e){var t=a.state.manager.toLowerCase()===e[0].toLowerCase();a.setState({isManager:t})},a.onSubmit=function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){var n;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!(a.state.value<=.01)){e.next=4;break}return a.showErrorMessage("Ether of value greater than 0.01 ether is required to enter"),e.abrupt("return");case 4:return a.setState({button:!1}),e.next=7,d.eth.getAccounts();case 7:return n=e.sent,a.showWaitingForTransactionMessage(),e.next=11,m.methods.enter().send({from:n[0],value:d.utils.toWei(a.state.value,"ether")}).then(function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){var n,r;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.b.dismiss(),a.showTransactionMessage("Transaction completed. Transaction ID - ".concat(t.transactionHash)),e.next=4,m.methods.getPlayers().call();case 4:return n=e.sent,e.next=7,d.eth.getBalance(m.options.address);case 7:r=e.sent,a.setState({players:n,balance:r,value:""});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){y.b.dismiss(),a.showErrorMessage("Transaction Aborted by User.")}));case 11:a.setState({button:!0});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.showTransactionMessage=function(e){y.b.success(e,{position:"top-left",autoClose:!1,closeOnClick:!0,style:{width:"fit-content"}})},a.showWaitingForTransactionMessage=function(){y.b.info("Waiting for transaction to complete...",{position:"top-left",autoClose:!1,closeOnClick:!1,closeButton:!1})},a.showErrorMessage=function(e){y.b.error(e,{position:"top-left",autoClose:3e3})},a.onClick=Object(i.a)(Object(o.a)().mark((function e(){var t;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.eth.getAccounts();case 2:if((t=e.sent)[0]===a.state.manager){e.next=6;break}return a.showErrorMessage("You do not have the authority."),e.abrupt("return");case 6:if(0!==a.state.players.length){e.next=9;break}return a.showErrorMessage("No players found."),e.abrupt("return");case 9:return a.setState({button:!1}),a.showWaitingForTransactionMessage(),e.next=13,m.methods.pickWinner().send({from:t[0]}).then(function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.methods.winner().call().then(function(){var e=Object(i.a)(Object(o.a)().mark((function e(t){var n;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(new Date).toLocaleString("en",{timeZoneName:"long",timeZone:"IST",weekday:"short",year:"numeric",month:"short",day:"numeric",hour12:!0,hour:"numeric",minute:"numeric",second:"numeric"}),e.next=3,f.a.post("http://localhost:3001",{winner:t,no_of_participations:a.state.players.length,value:d.utils.fromWei(a.state.balance,"ether")}).then((function(e){y.b.dismiss(),a.showTransactionMessage("A winner has been picked."),a.setState({players:[],balance:"",previousWinner:"".concat(e.data.winner," [ declared on ").concat(n," ] won ").concat(e.data.value," ether")})})).catch((function(e){return console.log(e)}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){y.b.dismiss(),a.showErrorMessage("Winner is not picked yet as per manager's preferences.")}));case 13:a.setState({button:!0});case 14:case"end":return e.stop()}}),e)}))),a.state={manager:"",players:[],balance:"",value:"",previousWinner:"--",button:!0,isManager:!1},a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=Object(i.a)(Object(o.a)().mark((function e(){var t,n,a,r,s,c,i;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.methods.manager().call();case 2:return t=e.sent,e.next=5,window.ethereum.request({method:"eth_requestAccounts"});case 5:return n=e.sent,a=t.toLowerCase()===n[0].toLowerCase(),window.ethereum.on("accountsChanged",this.handleAccountsChanged),e.next=10,m.methods.getPlayers().call();case 10:return r=e.sent,e.next=13,d.eth.getBalance(m.options.address);case 13:return s=e.sent,e.next=16,f.a.get("http://localhost:3001").catch((function(e){return console.log(e)}));case 16:c=e.sent,i=new Date(c.data.createdAt),this.setState({manager:t,players:r,balance:s,previousWinner:c.data.id?"".concat(c.data.winner," [ declared on ").concat(i.toLocaleString("en",{timeZoneName:"long",timeZone:"IST",weekday:"short",year:"numeric",month:"short",day:"numeric",hour12:!0,hour:"numeric",minute:"numeric",second:"numeric"})," ] won ").concat(c.data.value," ether"):"--",isManager:a});case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){window.ethereum.removeListener("accountsChanged",this.handleAccountsChanged)}},{key:"render",value:function(){var e=this;return Object(w.jsxs)("div",{className:"App",children:[Object(w.jsx)(y.a,{position:"top-left"}),Object(w.jsx)("img",{src:j,alt:"Lottery",className:"lottery-image"}),Object(w.jsx)("h2",{children:"LOTTERY CONTRACT"}),window.ethereum&&Object(w.jsxs)("p",{children:["The manager of this contract is ",Object(w.jsx)("b",{children:this.state.manager}),". There are currently ",Object(w.jsxs)("b",{children:[this.state.players.length," people"]})," entered, competing to win"," ",Object(w.jsxs)("b",{children:[d.utils.fromWei(this.state.balance,"ether")," ethers"]}),"."]}),Object(w.jsx)("hr",{}),window.ethereum?Object(w.jsxs)("div",{children:[Object(w.jsxs)("form",{onSubmit:this.onSubmit,className:"entry-form",children:[Object(w.jsx)("h4",{children:"Want to try your luck?"}),Object(w.jsxs)("div",{className:"input-container",children:[Object(w.jsx)("label",{children:"Amount of ether to enter"}),Object(w.jsx)("input",{type:"number",placeholder:"Enter value > 0.01 ether",value:this.state.value,onChange:function(t){return e.setState({value:t.target.value})},required:!0})]}),Object(w.jsx)("button",{className:"entry-button",disabled:""===this.state.manager||!this.state.button,onClick:this.openModal,children:"Enter"})]}),this.state.isManager&&Object(w.jsxs)("div",{className:"winner-section",children:[Object(w.jsx)("hr",{}),Object(w.jsx)("h4",{children:"Time to pick a Winner"}),Object(w.jsx)("button",{onClick:this.onClick,className:"winner-button",disabled:!this.state.button,children:"Pick a Winner"})]}),Object(w.jsx)("hr",{}),Object(w.jsxs)("h4",{className:"previous-winner",children:["Recent Winner: ",this.state.previousWinner]})]}):Object(w.jsx)("div",{className:"no-metamask",children:Object(w.jsx)("p",{children:"Please install Metamask to use this application."})})]})}}]),n}(r.a.Component),v=g;c.a.render(Object(w.jsx)(r.a.StrictMode,{children:Object(w.jsx)(v,{})}),document.getElementById("root"))}},[[34,1,2]]]);
//# sourceMappingURL=main.a85718be.chunk.js.map