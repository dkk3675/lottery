(this["webpackJsonplottery-react"]=this["webpackJsonplottery-react"]||[]).push([[0],{24:function(e,t,n){},25:function(e,t,n){},35:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),s=n(13),o=n.n(s),c=(n(24),n(4)),i=n(10),u=n(5),l=n(6),h=n(18),p=n(17),b=(n(25),n(16)),d=new(n.n(b).a)(window.ethereum),m=new d.eth.Contract([{constant:!0,inputs:[],name:"manager",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"pickWinner",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[],name:"getPlayers",outputs:[{name:"",type:"address[]"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"winner",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"enter",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[{name:"",type:"uint256"}],name:"players",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"}],"0x2c06AFe194FA2942DDcF9DabCaB9B79E2DF396F3"),f=n(37),y=n.p+"static/media/lottery.1bae6b1d.png",j=n(8),w=(n(29),n(3)),g=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={manager:"",players:[],balance:"",value:"",previousWinner:"--",button:!0,isManager:!1},e.handleAccountsChanged=function(t){var n=e.state.manager.toLowerCase()===t[0].toLowerCase();e.setState({isManager:n})},e.onSubmit=function(){var t=Object(i.a)(Object(c.a)().mark((function t(n){var a;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),!(e.state.value<=.01)){t.next=4;break}return e.showErrorMessage("Ether of value greater than 0.01 ether is required to enter"),t.abrupt("return");case 4:return e.setState({button:!1}),t.next=7,d.eth.getAccounts();case 7:return a=t.sent,e.showWaitingForTransactionMessage(),t.next=11,m.methods.enter().send({from:a[0],value:d.utils.toWei(e.state.value,"ether")}).then(function(){var t=Object(i.a)(Object(c.a)().mark((function t(n){var a,r;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return j.b.dismiss(),e.showTransactionMessage("Transaction completed. Transaction ID - ".concat(n.transactionHash)),t.next=4,m.methods.getPlayers().call();case 4:return a=t.sent,t.next=7,d.eth.getBalance(m.options.address);case 7:r=t.sent,e.setState({players:a,balance:r,value:""});case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){j.b.dismiss(),e.showErrorMessage("Transaction Aborted by User.")}));case 11:e.setState({button:!0});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.showTransactionMessage=function(e){j.b.success(e,{position:"top-left",autoClose:!1,closeOnClick:!0,style:{width:"fit-content"}})},e.showWaitingForTransactionMessage=function(){j.b.info("Waiting for transaction to complete...",{position:"top-left",autoClose:!1,closeOnClick:!1,closeButton:!1})},e.showErrorMessage=function(e){j.b.error(e,{position:"top-left",autoClose:3e3})},e.onClick=Object(i.a)(Object(c.a)().mark((function t(){var n;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.eth.getAccounts();case 2:if((n=t.sent)[0]===e.state.manager){t.next=6;break}return e.showErrorMessage("You do not have the authority."),t.abrupt("return");case 6:if(0!==e.state.players.length){t.next=9;break}return e.showErrorMessage("No players found."),t.abrupt("return");case 9:return e.setState({button:!1}),e.showWaitingForTransactionMessage(),t.next=13,m.methods.pickWinner().send({from:n[0]}).then(function(){var t=Object(i.a)(Object(c.a)().mark((function t(n){return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.methods.winner().call().then(function(){var t=Object(i.a)(Object(c.a)().mark((function t(n){var a;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=(new Date).toLocaleString("en",{timeZoneName:"long",timeZone:"IST",weekday:"short",year:"numeric",month:"short",day:"numeric",hour12:!0,hour:"numeric",minute:"numeric",second:"numeric"}),t.next=3,f.a.post("http://ec2-65-2-85-28.ap-south-1.compute.amazonaws.com:3001",{winner:n,no_of_participations:e.state.players.length,value:d.utils.fromWei(e.state.balance,"ether")}).then((function(t){j.b.dismiss(),e.showTransactionMessage("A winner has been picked."),e.setState({players:[],balance:"",previousWinner:"".concat(t.data.winner," [ declared on ").concat(a," ] won ").concat(t.data.value," ether")})})).catch((function(e){return console.log(e)}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){j.b.dismiss(),e.showErrorMessage("Winner is not picked yet as per manager's preferences.")}));case 13:e.setState({button:!0});case 14:case"end":return t.stop()}}),t)}))),e}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=Object(i.a)(Object(c.a)().mark((function e(){var t,n,a,r,s,o,i;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.methods.manager().call();case 2:return t=e.sent,e.next=5,window.ethereum.request({method:"eth_requestAccounts"});case 5:return n=e.sent,a=t.toLowerCase()===n[0].toLowerCase(),window.ethereum.on("accountsChanged",this.handleAccountsChanged),e.next=10,m.methods.getPlayers().call();case 10:return r=e.sent,e.next=13,d.eth.getBalance(m.options.address);case 13:return s=e.sent,e.next=16,f.a.get("http://ec2-65-2-85-28.ap-south-1.compute.amazonaws.com:3001").catch((function(e){return console.log(e)}));case 16:o=e.sent,i=new Date(o.data.createdAt),this.setState({manager:t,players:r,balance:s,previousWinner:o.data.id?"".concat(o.data.winner," [ declared on ").concat(i.toLocaleString("en",{timeZoneName:"long",timeZone:"IST",weekday:"short",year:"numeric",month:"short",day:"numeric",hour12:!0,hour:"numeric",minute:"numeric",second:"numeric"})," ] won ").concat(o.data.value," ether"):"--",isManager:a});case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){window.ethereum.removeListener("accountsChanged",this.handleAccountsChanged)}},{key:"render",value:function(){var e=this;return Object(w.jsxs)("div",{className:"App",children:[Object(w.jsx)(j.a,{position:"top-left"}),Object(w.jsx)("img",{src:y,alt:"Lottery",className:"lottery-image"}),Object(w.jsx)("h2",{children:"LOTTERY CONTRACT"}),Object(w.jsxs)("p",{children:["The manager of this contract is ",Object(w.jsx)("b",{children:this.state.manager}),". There are currently ",Object(w.jsxs)("b",{children:[this.state.players.length," people"]})," entered, competing to win ",Object(w.jsxs)("b",{children:[d.utils.fromWei(this.state.balance,"ether")," ethers"]}),"."]}),Object(w.jsx)("hr",{}),Object(w.jsxs)("form",{onSubmit:this.onSubmit,className:"entry-form",children:[Object(w.jsx)("h4",{children:"Want to try your luck?"}),Object(w.jsxs)("div",{className:"input-container",children:[Object(w.jsx)("label",{children:"Amount of ether to enter"}),Object(w.jsx)("input",{type:"number",placeholder:"Enter value > 0.01 ether",value:this.state.value,onChange:function(t){return e.setState({value:t.target.value})},required:!0})]}),Object(w.jsx)("button",{className:"entry-button",disabled:""===this.state.manager||!this.state.button,onClick:this.openModal,children:"Enter"})]}),this.state.isManager&&Object(w.jsxs)("div",{className:"winner-section",children:[Object(w.jsx)("hr",{}),Object(w.jsx)("h4",{children:"Time to pick a Winner"}),Object(w.jsx)("button",{onClick:this.onClick,className:"winner-button",disabled:!this.state.button,children:"Pick a Winner"})]}),Object(w.jsx)("hr",{}),Object(w.jsxs)("h4",{className:"previous-winner",children:["Recent Winner: ",this.state.previousWinner]})]})}}]),n}(r.a.Component),v=g;o.a.render(Object(w.jsx)(r.a.StrictMode,{children:Object(w.jsx)(v,{})}),document.getElementById("root"))}},[[35,1,2]]]);
//# sourceMappingURL=main.9813bb7e.chunk.js.map